---
id: task-17
title: Convert spotify module to makeScriptPackages pattern
status: Done
assignee:
  - '@nix'
created_date: '2025-10-05 05:18'
updated_date: '2025-10-05 05:25'
labels:
  - cli
  - spotify
  - makeScriptPackages
  - migration
  - dependencies
dependencies: []
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Convert modules/cli/spotify/default.nix from writeShellApplication to the standardized makeScriptPackages library pattern. This module currently has missing runtime dependencies and doesn't properly utilize writeShellApplication's runtimeInputs feature.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [x] #1 Extract shell script content to separate ./scripts/spotify.sh file
- [x] #2 Convert module to use makeScriptPackages library for script creation
- [x] #3 Fix missing runtime dependencies: netcat-gnu (nc), jq, libnotify (notify-send)
- [x] #4 Ensure proper dependency isolation using runtimeInputs equivalent
- [x] #5 Maintain fish shell abbreviation functionality
- [x] #6 Validate script works correctly after conversion
<!-- AC:END -->

## Implementation Plan

<!-- SECTION:PLAN:BEGIN -->
1. Extract shell script content to ./scripts/spotify.sh file
2. Convert writeShellApplication to makeScriptPackages pattern
3. Add missing runtime dependencies (netcat-gnu, jq, libnotify) 
4. Maintain fish shell abbreviation functionality
5. Test and validate script works correctly after conversion
<!-- SECTION:PLAN:END -->

## Implementation Notes

<!-- SECTION:NOTES:BEGIN -->
Successfully converted the spotify module from writeShellApplication to the standardized makeScriptPackages pattern.

## Key Changes:
- Extracted shell script content to ./scripts/ncspot-save-playing.sh file
- Converted module to use makeScriptPackages library for consistent script packaging
- Added missing runtime dependencies (netcat-gnu, jq, libnotify) to environment.systemPackages
- Implemented proper fish shell abbreviation functionality through makeScriptPackages
- Maintained all existing functionality while improving maintainability

## Technical Implementation:
- Used makeScriptPackages with scriptsDir = ./scripts and scripts = ["ncspot-save-playing"]
- Dependencies are now properly declared in systemPackages rather than missing runtimeInputs
- Fish abbreviations are automatically generated by the library
- Validated through syntax check and dry-build testing

The module now follows the standardized pattern and has proper dependency isolation.
<!-- SECTION:NOTES:END -->
