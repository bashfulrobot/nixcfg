#!/usr/bin/env bash

# Rofi-based fish commands cheatsheet
# Replaces fish-help with consistent rofi styling

# Fish command data extracted from your fish configuration
# Format: "Type Command - Description"
COMMANDS=(
    "<span color='gray'><i>System Commands:</i></span>"
    "<b>ğŸ”„ sys-commit-rebuild</b>  <i>Commit changes and rebuild NixOS system</i>"
    "<b>ğŸ”„ sys-update-push</b>  <i>Pull, upgrade, commit and push system changes</i>"
    "<b>ğŸ“‹ sys-support-info</b>  <i>Copy system info to clipboard</i>"
    "<b>ğŸ“‹ sys-support-info-extended</b>  <i>Copy extended system info to clipboard</i>"
    "<b>ğŸ sys-troubleshoot-last-boot</b>  <i>Upload last boot logs to pastebin</i>"
    "<b>ğŸ“œ sys-logs-home-manager</b>  <i>Restart and show home-manager logs</i>"
    "<b>ğŸ’» sys-tailscale-up-laptop</b>  <i>Start tailscale for laptop mode</i>"
    "<b>ğŸ–¥ï¸ sys-tailscale-up-desktop</b>  <i>Start tailscale for desktop mode</i>"
    "<b>ğŸ”¤ sys-font-cache-refresh</b>  <i>Refresh font cache</i>"
    "<b>ğŸ”¤ sys-font-list</b>  <i>List all fonts</i>"
    "<b>ğŸ“¹ sys-get-video-id</b>  <i>Get video device IDs</i>"
    "<b>ğŸŒ sys-get-ips</b>  <i>List network interfaces and IPs</i>"
    "<b>ğŸ“– sys-docs-nixcfg</b>  <i>Open NixOS configuration manual</i>"
    "<b>ğŸ“– sys-docs-home-manager</b>  <i>Open Home Manager manual</i>"
    "<b>ğŸ sys-rebuild-mac</b>  <i>Rebuild macOS configuration</i>"
    ""
    "<span color='gray'><i>Nix Commands:</i></span>"
    "<b>ğŸ—ï¸ nix-build</b>  <i>Build NixOS config without switching</i>"
    "<b>ğŸ”„ nix-rebuild</b>  <i>Rebuild and switch to new NixOS config</i>"
    "<b>ğŸ§ª nix-test</b>  <i>Test NixOS config (dry run)</i>"
    "<b>â¬†ï¸ nix-upgrade</b>  <i>Update flake inputs and rebuild</i>"
    "<b>ğŸ” nix-store-find-file</b>  <i>Find file in active nix store [search-term]</i>"
    "<b>âš¡ nix-run-ephemeral</b>  <i>Run a nixpkgs package temporarily [package-name]</i>"
    "<b>ğŸ” nix-pkg-search</b>  <i>Search nixpkgs for packages [search-term]</i>"
    "<b>ğŸ” nix-pkg-search-cli</b>  <i>Search nixpkgs via nix search [search-term]</i>"
    "<b>ğŸ§¹ nix-lint</b>  <i>Lint nix files with statix</i>"
    "<b>â„¹ï¸ nix-info</b>  <i>Display nix system information</i>"
    "<b>ğŸ“‡ nix-index-update</b>  <i>Update nix-index database</i>"
    ""
    "<span color='gray'><i>Kubernetes Commands:</i></span>"
    "<b>âš™ï¸ k8s-set-config</b>  <i>Select kubeconfig file with fzf</i>"
    "<b>ğŸ·ï¸ k8s-set-namespace</b>  <i>Select kubernetes namespace with fzf</i>"
    "<b>ğŸ—‘ï¸ k8s-ns-delete-all-resources</b>  <i>Delete all resources in namespace [namespace]</i>"
    "<b>ğŸ” k8s-ns-find-stuck</b>  <i>Find stuck terminating resources [namespace]</i>"
    "<b>ğŸ’€ k8s-ns-force-terminate</b>  <i>Force terminate stuck namespace</i>"
    "<b>ğŸ“¦ k8s-get-containers</b>  <i>List containers in pods by namespace [namespace]</i>"
    "<b>ğŸ› ï¸ k8s-setup-config</b>  <i>Setup kubernetes configuration</i>"
    "<b>â˜¸ï¸ k8s</b>  <i>kubectl with color support</i>"
    "<b>ğŸ” k8s-scan</b>  <i>Run rustscan in docker</i>"
    ""
    "<span color='gray'><i>File System Commands:</i></span>"
    "<b>ğŸ—‘ï¸ fs-remove-interactive</b>  <i>Find and remove files/dirs interactively</i>"
    "<b>ğŸ—ï¸ fs-nav-terraform</b>  <i>Navigate to terraform directory</i>"
    "<b>â˜ï¸ fs-nav-terraform-clusters</b>  <i>Navigate to terraform clusters</i>"
    "<b>ğŸ“¦ fs-nav-terraform-modules</b>  <i>Navigate to terraform modules</i>"
    "<b>âœï¸ fs-nav-terraform-edit</b>  <i>Navigate to terraform and edit</i>"
    "<b>â„ï¸ fs-nav-nixcfg</b>  <i>Navigate to nixcfg directory</i>"
    "<b>ğŸ“ fs-nav-scratch</b>  <i>Navigate to scratch directory</i>"
    "<b>ğŸ“· fs-nav-screenshots</b>  <i>Navigate to screenshots directory</i>"
    "<b>ğŸ” fs-find-files</b>  <i>Find files with fzf and preview</i>"
    "<b>ğŸ“‹ fs-list</b>  <i>Enhanced ls with eza</i>"
    "<b>ğŸ‘ï¸ fs-list-all</b>  <i>Enhanced ls -a with eza</i>"
    "<b>ğŸŒ³ fs-tree</b>  <i>Tree view with eza</i>"
    "<b>ğŸŒ³ fs-tree-all</b>  <i>Tree view with hidden files</i>"
    "<b>ğŸ’¾ fs-disk-usage</b>  <i>Disk usage with dust</i>"
    "<b>â¬†ï¸ fs-nav-up</b>  <i>Go up one directory</i>"
    "<b>â¬†ï¸ fs-nav-up-2</b>  <i>Go up two directories</i>"
    "<b>â¬†ï¸ fs-nav-up-3</b>  <i>Go up three directories</i>"
    "<b>â¬†ï¸ fs-nav-up-4</b>  <i>Go up four directories</i>"
    "<b>ğŸ“Š fs-ncdu</b>  <i>Interactive disk usage with gdu</i>"
    ""
    "<span color='gray'><i>Development Commands:</i></span>"
    "<b>âœï¸ dev-edit</b>  <i>Open editor (helix)</i>"
    "<b>â„ï¸ dev-edit-nixcfg</b>  <i>Open nixcfg in editor</i>"
    "<b>ğŸ’» dev-edit-vscode-nixcfg</b>  <i>Open nixcfg in VSCode</i>"
    "<b>ğŸ™ dev-git</b>  <i>git command</i>"
    "<b>ğŸ³ dev-docker</b>  <i>docker command</i>"
    "<b>ğŸ³ dev-docker-compose</b>  <i>docker compose command</i>"
    "<b>ğŸš€ dev-git-commit-push</b>  <i>Pull, add, commit and push changes</i>"
    "<b>ğŸ“Š dev-process-list</b>  <i>Enhanced process list with procs</i>"
    "<b>â“ dev-help</b>  <i>Get help with tldr</i>"
    "<b>ğŸ“Š dev-top</b>  <i>System monitor with btop</i>"
    "<b>ğŸ“¡ dev-ping</b>  <i>Enhanced ping with gping</i>"
    "<b>ğŸ“„ dev-yaml-viewer</b>  <i>View YAML files with jless</i>"
    "<b>ğŸªŸ sys-get-wm-class</b>  <i>Get window manager class for GNOME</i>"
    "<b>ğŸªŸ sys-get-hypr-class</b>  <i>Get window class for Hyprland</i>"
    "<b>ğŸ§¹ dev-jlint</b>  <i>Lint nix files with tab completion [file.nix]</i>"
    "<b>âœ… dev-jcheck</b>  <i>Check nix file syntax [file.nix ...]</i>"
    "<b>ğŸ“¥ k8s-download-kubeconfig</b>  <i>Download kubeconfig from remote server [ip] [cluster-name]</i>"
    ""
    "<span color='gray'><i>Application Commands:</i></span>"
    "<b>ğŸ“ app-scratch-new</b>  <i>Create new scratch note with template</i>"
    "<b>ğŸ“š app-scratch-browse</b>  <i>Browse scratch notes with glow</i>"
    "<b>ğŸ” app-onepass-fzf</b>  <i>Browse 1Password items with fzf</i>"
    "<b>ğŸ“± app-send-to-phone</b>  <i>Send file to phone via tailscale</i>"
    "<b>ğŸ¬ app-mpv-youtube</b>  <i>Play video with mpv</i>"
    "<b>ğŸ“‹ app-pueue</b>  <i>Task queue manager</i>"
    "<b>â˜¸ï¸ app-kubitect</b>  <i>Kubitect with steam-run</i>"
    ""
    "<span color='gray'><i>Media Commands:</i></span>"
    "<b>ğŸ¬ media-video-1080p</b>  <i>Transcode video to 1080p [input_file]</i>"
    "<b>ğŸ¬ media-video-4k</b>  <i>Transcode video to 4K [input_file]</i>"
    "<b>ğŸ–¼ï¸ media-img-to-jpg</b>  <i>Convert image to JPG [input_file]</i>"
    "<b>ğŸ–¼ï¸ media-img-to-jpg-small</b>  <i>Convert image to small JPG [input_file]</i>"
    "<b>ğŸ–¼ï¸ media-img-to-png</b>  <i>Convert image to optimized PNG [input_file]</i>"
    ""
    "<span color='gray'><i>Common Aliases:</i></span>"
    "<b>â˜¸ï¸ k</b>  <i>kubectl</i>"
    "<b>ğŸ™ g</b>  <i>git</i>"
    "<b>ğŸ³ d</b>  <i>docker</i>"
    "<b>âœï¸ e</b>  <i>hx (helix editor)</i>"
    "<b>âš™ï¸ t</b>  <i>talosctl</i>"
    "<b>ğŸ—ï¸ tf</b>  <i>terraform</i>"
    "<b>ğŸ“‹ ls</b>  <i>eza with icons</i>"
    "<b>âœï¸ vi / vim</b>  <i>hx (helix editor)</i>"
    "<b>ğŸ“Š top / htop</b>  <i>btop</i>"
    "<b>â“ man</b>  <i>tldr</i>"
    "<b>ğŸ“¡ ping</b>  <i>gping</i>"
    "<b>ğŸ“Š ps</b>  <i>procs</i>"
    ""
    "<span color='gray'><i>Legend:</i></span>"
    "<b>ğŸ”„</b> <i>System rebuild/update commands</i>"
    "<b>ğŸ”</b> <i>Search/find commands</i>"
    "<b>ğŸ“</b> <i>Text/note commands</i>"
)

# Show rofi menu with fish commands using the main theme
rofi_theme="${XDG_CONFIG_HOME:-$HOME/.config}/rofi/launchers/type-2/style-2.rasi"
r_override="entry{placeholder:'ğŸ  Search Commands...';}listview{lines:20;columns:2;}window{width:80%;}"

CHOICE=$(printf '%s\n' "${COMMANDS[@]}" | rofi -dmenu -i -markup-rows -p "ğŸ  Fish Commands" -theme-str "$r_override" -theme "$rofi_theme")

# Extract command name from selection for clipboard copy
if [[ -n "$CHOICE" && "$CHOICE" != *"<span color='gray'>"* && "$CHOICE" != "" ]]; then
    # Extract command name between <b> tags, remove emoji indicator
    COMMAND=$(echo "$CHOICE" | sed -n 's/.*<b>[^ ]* *\([^<]*\)<\/b>.*/\1/p' | xargs)

    if [[ -n "$COMMAND" ]]; then
        # Copy command to clipboard
        echo "$COMMAND" | wl-copy --trim-newline

        # Show notification
        notify-send "ğŸ  Fish Command Copied" "$COMMAND copied to clipboard" -u low -t 2000 -i utilities-terminal --skip-summary
    fi
fi